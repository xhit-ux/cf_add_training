<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>我的 Codeforces Groups</title>
  <style>
    :root {
      color-scheme: light;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fb;
      color: #1f2d3d;
      margin: 0;
      padding: 0;
    }

    header {
      padding: 24px 32px 8px;
    }

    h2 {
      margin: 0 0 6px;
      font-weight: 600;
    }

    p.subtext {
      margin: 0;
      color: #6c757d;
      font-size: 14px;
    }

    .card {
      margin: 0 32px 24px;
      background-color: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      padding: 24px;
    }

    .table-wrapper {
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #e4e9f2;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 640px;
    }

    th,
    td {
      padding: 12px 16px;
      text-align: left;
    }

    th {
      background-color: #0f62fe;
      color: #fff;
      font-weight: 500;
    }

    tr:not(:last-child) td {
      border-bottom: 1px solid #edf1f7;
    }

    tr:nth-child(even) td {
      background-color: #f8fbff;
    }

    tr:hover td {
      background-color: #eef4ff;
    }

    input[type="checkbox"] {
      transform: scale(1.1);
      cursor: pointer;
    }

    a.groupName {
      color: #0f62fe;
      text-decoration: none;
      font-weight: 500;
    }

    a.groupName:hover {
      text-decoration: underline;
    }

    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 16px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      background: #eef4ff;
      color: #0f62fe;
      padding: 4px 12px;
      font-size: 13px;
      font-weight: 600;
    }

    .toolbar button {
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      background-color: #28a745;
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .toolbar button:disabled {
      background-color: #94d3a2;
      cursor: not-allowed;
    }

    .toolbar button:not(:disabled):hover {
      background-color: #1f8b39;
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .loading-overlay.active {
      display: flex;
    }

    .spinner {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: 4px solid rgba(255, 255, 255, 0.35);
      border-top-color: #fff;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>

</head>

<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <header>
    <h2>选择目标 Group</h2>
    <p class="subtext">
      勾选需要同步 Mashup 的所有小组，系统将依次添加；支持多选。
    </p>
  </header>

  <div class="card">
    <div class="toolbar">
      <span class="pill" id="selectionIndicator">已选择 0 个 Group</span>
      <button id="confirmButton" disabled>确定，前往题目配置</button>
    </div>

    <div class="table-wrapper">
      <table>
        <tbody id="groupBody">
          <tr>
            <td>正在加载 Group 列表…</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const groupBody = document.getElementById('groupBody');
    const indicator = document.getElementById('selectionIndicator');
    const confirmBtn = document.getElementById('confirmButton');
    const overlay = document.getElementById('loadingOverlay');

    function updateSelectionIndicator() {
      const selected = document.querySelectorAll('input[name="group"]:checked');
      indicator.textContent = `已选择 ${selected.length} 个 Group`;
      confirmBtn.disabled = selected.length === 0;
    }

    window.electronAPI.onGroupHtml((html) => {
      groupBody.innerHTML = html;
      updateSelectionIndicator();

      groupBody.addEventListener('change', (event) => {
        const target = event.target;
        if (target && typeof target.matches === 'function' && target.matches('input[name="group"]')) {
          updateSelectionIndicator();
        }
      });
    });

    confirmBtn.addEventListener('click', () => {
      const selected = Array.from(document.querySelectorAll('input[name="group"]:checked')).map(cb => cb.value);
      if (!selected.length) {
        alert('请至少选择一个 Group');
        return;
      }

      localStorage.setItem('selectedGroups', JSON.stringify(selected));
      confirmBtn.disabled = true;
      overlay.classList.add('active');

      setTimeout(() => {
        location.href = 'setProblem.html';
      }, 300);
    });
  </script>
</body>

</html>
